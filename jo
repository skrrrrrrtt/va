repeat task.wait() until game:IsLoaded()

-- =============================
-- CLEAN CONFIG
-- =============================

-- Booth goal
_G.goalAmount = 1000      -- goal number
_G.enableBoothText = true -- edit booth text
_G.updateTextOnDonate = false -- DO NOT change text when donated

-- Booth theme
_G.headerText = "GOAL"
_G.headerFont = "LuckiestGuy"
_G.headerColor = "#FFFFFF"
_G.strokeColor = "#000000"
_G.strokeThickness = 5
_G.boothUpdateInterval = 10

-- Server hop
_G.enableHop = true
_G.minPlayersBeforeHop = 5
_G.serverSearchPages = 5
_G.initialHopWait = 15
_G.hopCheckInterval = 20

-- Begging
_G.enableBeg = true
_G.begInterval = 45
_G.begMessages = {
    "please donate if you can",
    "even 1 robux helps",
    "trying to reach my goal",
    "any small donation helps"
}
_G.begRandomize = true

-- Donation jump
_G.jumpOnDonate = true
_G.jumpCount = 3
_G.jumpDelay = 0.35


-- =============================
-- SERVICES
-- =============================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local TextChatService = game:FindService("TextChatService")
local Workspace = workspace
local VirtualUser = game:GetService("VirtualUser")

-- Anti-AFK
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- Wait UI
local pg = LocalPlayer:WaitForChild("PlayerGui")
repeat task.wait() until pg:FindFirstChild("MapUIContainer")
local BoothUI = pg.MapUIContainer.MapUI:WaitForChild("BoothUI")
repeat task.wait() until LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")

local raisedStat = LocalPlayer.leaderstats.Raised

-- Safe require
local function requirex(mod)
    local result
    repeat
        local ok, res = pcall(require, mod)
        if ok then result = res end
        task.wait()
    until result
    return result
end

local Remotes = nil
if ReplicatedStorage:FindFirstChild("Remotes") then
    Remotes = requirex(ReplicatedStorage.Remotes)
end

-- Hex â†’ Color3
local function hexToColor3(hex)
    hex = hex:gsub("#","")
    return Color3.fromRGB(
        tonumber("0x"..hex:sub(1,2)),
        tonumber("0x"..hex:sub(3,4)),
        tonumber("0x"..hex:sub(5,6))
    )
end

local headerColor3 = hexToColor3(_G.headerColor)
local strokeColor3 = hexToColor3(_G.strokeColor)


-- =====================================================
-- SERVER HOP
-- =====================================================
local function searchServers(pages)
    local list = {}
    local cursor
    local base = "https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"

    for i = 1, pages do
        local url = cursor and (base.."&cursor="..cursor) or base
        local ok, body = pcall(game.HttpGet, game, url)
        if not ok then break end

        local data = HttpService:JSONDecode(body)
        for _, s in ipairs(data.data) do
            if s.id ~= game.JobId and s.playing < s.maxPlayers then
                table.insert(list, s)
            end
        end

        cursor = data.nextPageCursor
        if not cursor or cursor == "null" then break end
    end

    return list
end

local function doHop()
    local servers = searchServers(_G.serverSearchPages)
    if #servers == 0 then
        TeleportService:Teleport(game.PlaceId)
        return
    end

    local pick = servers[math.random(1,#servers)]
    TeleportService:TeleportToPlaceInstance(game.PlaceId, pick.id)
end

if _G.enableHop then
    task.spawn(function()
        task.wait(_G.initialHopWait)
        while task.wait(_G.hopCheckInterval) do
            if #Players:GetPlayers() <= _G.minPlayersBeforeHop then
                doHop()
                return
            end
        end
    end)
end


-- =====================================================
-- BOOTH CLAIM
-- =====================================================
local function isBooth(part)
    return part and type(part.GetAttribute)=="function" and typeof(part:GetAttribute("BoothSlot"))=="number"
end

local function claimBooth()
    for _, booth in ipairs(Workspace.BoothInteractions:GetChildren()) do
        if isBooth(booth) then
            local ui = BoothUI:FindFirstChild("BoothUI"..booth:GetAttribute("BoothSlot"))
            if ui and ui.Details.Owner.Text:lower():find("unclaim") then
                local prompt = booth:FindFirstChildOfClass("ProximityPrompt")
                if prompt then
                    pcall(fireproximityprompt, prompt, 0)
                    task.wait(1)

                    -- verify
                    if ui.Details.Owner.Text:lower():find(LocalPlayer.DisplayName:lower()) then
                        -- TP and dance
                        local hrp = LocalPlayer.Character.HumanoidRootPart
                        hrp.CFrame = booth.CFrame * CFrame.new(3,3,3)
                        hrp.CFrame = CFrame.new(hrp.Position, hrp.Position + Vector3.new(0,0,-1))
                        return
                    end
                end
            end
        end
    end
end

task.spawn(function()
    task.wait(2)
    claimBooth()
end)

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(2)
    claimBooth()
end)


-- =====================================================
-- CLEAN BOOTH TEXT (ONLY "GOAL X / 1000")
-- =====================================================
function updateBoothText()
    if not _G.enableBoothText then return end

    local raised = raisedStat.Value or 0
    local goal = _G.goalAmount

    local text = string.format([[
<stroke color="%s" thickness="%d">
    <font size="40">
        <font color="%s">
            <font face="%s">
                %s %s / %s
            </font>
        </font>
    </font>
</stroke>
]],
        _G.strokeColor,
        _G.strokeThickness,
        _G.headerColor,
        _G.headerFont,
        _G.headerText,
        raised,
        goal
    )

    if Remotes and Remotes.Event then
        pcall(function()
            Remotes.Event("SetCustomization"):FireServer({
                text = text,
                richText = true,
                filter = false
            }, "booth")
        end)
    end
end

task.spawn(function()
    while task.wait(_G.boothUpdateInterval) do
        updateBoothText()
    end
end)


-- =====================================================
-- DONATION JUMP
-- =====================================================
local lastRaised = raisedStat.Value
raisedStat.Changed:Connect(function(v)
    if v > lastRaised then
        if _G.jumpOnDonate then
            local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            for i = 1, _G.jumpCount do
                hum:ChangeState(Enum.HumanoidStateType.Jumping)
                task.wait(_G.jumpDelay)
            end
        end
        if _G.updateTextOnDonate then updateBoothText() end
    end
    lastRaised = v
end)


-- =====================================================
-- BEGGING SYSTEM
-- =====================================================
local function sayChat(msg)
    -- Default chat
    local ok = pcall(function()
        ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(msg, "All")
    end)
    if ok then return end

    -- TextChatService fallback
    if TextChatService and TextChatService.TextChannels:FindFirstChild("RBXGeneral") then
        pcall(function()
            TextChatService.TextChannels.RBXGeneral:SendAsync(msg)
        end)
    end
end

if _G.enableBeg then
    task.spawn(function()
        while true do
            local msg = _G.begRandomize
                and _G.begMessages[math.random(1,#_G.begMessages)]
                or _G.begMessages[1]

            sayChat(msg)
            task.wait(_G.begInterval)
        end
    end)
end
